<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Printify Mockup</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 50px auto;
      padding: 20px;
    }
    button {
      background: #0070f3;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #0051cc;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #status {
      margin: 20px 0;
      padding: 15px;
      border-radius: 5px;
      font-weight: bold;
    }
    #status.loading {
      background: #fff3cd;
      color: #856404;
    }
    #status.success {
      background: #d4edda;
      color: #155724;
    }
    #status.error {
      background: #f8d7da;
      color: #721c24;
    }
    #mockups {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .mockup-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
    }
    .mockup-card img {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
    }
    .mockup-card .label {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
    }
    pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <h1>üß™ Printify Mockup Tester</h1>
  <p>Test the Printify mockup generation API with different products</p>
  
  <div>
    <button onclick="testMockup('canvas-12x18')">Test Canvas 12√ó18</button>
    <button onclick="testMockup('canvas-16x20')">Test Canvas 16√ó20</button>
    <button onclick="testMockup('canvas-18x24')">Test Canvas 18√ó24</button>
    <button onclick="testMockup('canvas-24x36')">Test Canvas 24√ó36</button>
  </div>
  
  <div id="status"></div>
  <div id="mockups"></div>
  <div id="details"></div>
  
  <script>
    async function testMockup(productKey) {
      const statusEl = document.getElementById('status');
      const mockupsEl = document.getElementById('mockups');
      const detailsEl = document.getElementById('details');
      
      statusEl.className = 'loading';
      statusEl.textContent = `Testing ${productKey}...`;
      mockupsEl.innerHTML = '';
      detailsEl.innerHTML = '';
      
      // Disable all buttons
      document.querySelectorAll('button').forEach(btn => btn.disabled = true);
      
      try {
        // Create a simple test image on a canvas
        const canvas = document.createElement('canvas');
        canvas.width = 3000;
        canvas.height = 3000;
        const ctx = canvas.getContext('2d');
        
        // White background
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, 3000, 3000);
        
        // Draw simple waveform
        ctx.strokeStyle = '#000000';
        ctx.lineWidth = 20;
        ctx.beginPath();
        for (let x = 0; x < 3000; x += 10) {
          const y = 1500 + Math.sin(x / 100) * 500;
          if (x === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.stroke();
        
        // Add text
        ctx.fillStyle = '#000000';
        ctx.font = 'bold 120px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(`TEST ${productKey.toUpperCase()}`, 1500, 500);
        
        // Convert to blob
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        
        // Create FormData
        const formData = new FormData();
        formData.append('productKey', productKey);
        formData.append('design', blob, 'test-design.png');
        
        statusEl.textContent = `Uploading and generating mockup for ${productKey}...`;
        
        // Send to API
        const response = await fetch('/api/printify-mockup', {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (response.ok) {
          statusEl.className = 'success';
          statusEl.textContent = `‚úÖ Success! Generated ${data.mockupUrls?.length || 0} mockup views for ${productKey}`;
          
          // Display mockups
          if (data.mockupUrls && data.mockupUrls.length > 0) {
            mockupsEl.innerHTML = data.mockupUrls.map((mockup, idx) => `
              <div class="mockup-card">
                <img src="${mockup.src}" alt="Mockup ${idx + 1}" />
                <div class="label">
                  View ${idx + 1}: ${mockup.cameraLabel}<br>
                  Position: ${mockup.position}
                </div>
              </div>
            `).join('');
          }
          
          // Show details
          detailsEl.innerHTML = '<h3>Response Details:</h3><pre>' + 
            JSON.stringify(data, null, 2) + '</pre>';
        } else {
          statusEl.className = 'error';
          statusEl.textContent = `‚ùå Failed: ${data.error}`;
          detailsEl.innerHTML = '<h3>Error Details:</h3><pre>' + 
            JSON.stringify(data, null, 2) + '</pre>';
        }
      } catch (error) {
        statusEl.className = 'error';
        statusEl.textContent = `‚ùå Error: ${error.message}`;
        detailsEl.innerHTML = '<h3>Error:</h3><pre>' + error.stack + '</pre>';
      } finally {
        // Re-enable buttons
        document.querySelectorAll('button').forEach(btn => btn.disabled = false);
      }
    }
  </script>
</body>
</html>
